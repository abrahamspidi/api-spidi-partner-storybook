import { Meta } from '@storybook/blocks';

<Meta title="API-MAP/Crixto/Mapeo Spidi/Sesion Cripto/3. Consulta Sesion Cripto" />

### **1\. Endpoints involucrados**

| Acción | Endpoint en SPIDI |
| ----- | ----- |
| Consultar status de orden | `GET /api/…/{crypto_order_id}` |

---

## **2\. Request**

`GET /api/payment-session/crypto/{crypto\_order\_id}`

## 3\. **Response:** 

| Campo en SPIDI () | Notas/Observaciones |
| ----- | ----- |
| success | true |
| message | Mensaje técnico/desarrollador |
| user\_message (raíz) | Mensaje de usuario sugerido ("Transaccion realizada correctamente" o "Esta orden se encuentra vencida o eliminada") |
| data.crypto\_order\_id  | ID de la orden cripto |
| data.status  | "paid","pending", "expired" |
| order\_details. type\_order | Mapeo: "BinancePay", etc. |
| order\_details. amount | Monto de la orden (rn VES) |
| order\_details. session\_id | ID de la sesión SPIDI |
| order\_details. platform | "Crixto" |
| order\_details. description | Concepto |
| order\_details. paid | Booleano,   true → paid |
| order\_details. rate\_bs\_usd | Tasa Bs/USD usada |
| order\_details. amount\_crypto\_paid | Monto pagado en cripto sin comisión (ej: "1,077) |
| order\_details. fee\_crixto | Comisión agregada en billetera Binance (ej."0,016" (1,5% de 1.077) |
| order\_details. amount\_crypto | Monto pagado en cripto con comisión (ej: "1,093) |
| order\_details. coin | Criptomoneda usada ("USDT", etc.) |
| order\_details. fee\_binancepay | Comisión de BinancePay (0.0033883) es 0,31% de 1.093) |
| order\_details. paid\_ves | Booleano, pagado en VES |
| order\_details. amount\_ves\_received | Monto recibido en VES (string, ej: "170,000") Se deja para ver si es redundante o no |
| order\_details. fee\_received | Comisión al recibir. Salió 0.00, se deja para estudiar. |
| order\_details. spidi\_id | Identificador único de cada SPIDI |
| order\_details. crypto\_reference | ID transacción cripto (en Binance o Crixto) |
| order\_details. key\_user | Quizás el ID usuario Binance |
| order\_details. crypto\_order\_id\_ext | ID adicional externo |
| order\_details. bs\_from\_RIF | RIF del agente de los Bs |
| order\_details. bs\_from\_Bank | Banco emisor de los  Bs |
| order\_details. clienttranid | ID transacción agente de los Bs |
| order\_details. coin\_received | Criptomoneda recibida \= VES |
| order\_details. bs\_from\_name | Nombre agente de los Bs |
| order\_details. bs\_from\_phone | Teléfono agente de los Bs |
| order\_details. bs\_from\_date | Fecha de la transacción |

### **Response de SPIDI (Pago exitoso)**

```json
{  
  "success": true,  
  "message": "Consulta realizada con éxito.",  
  "user\_message": "El pago fue realizado exitosamente.",  
  "data": {  
    "crypto\_order\_id": "392",  
    "status": "paid",  
    "order\_details": {  
      "type\_order": "BinancePay",  
      "amount": "170.00",  
      "session\_id": "098ace94-ce70-4203-abc3-80e20bb6e4c6",  
      "platform": "Crixto",  
      "description": "PUNTO DE VENTA",  
      "paid": true,  
      "rate\_bs\_usd": "157.78",  
      "amount\_crypto\_paid": "1,077",  
      "fee\_crixto": "0,016",  
      "amount\_crypto": "1,093",  
      "coin": "USDT",  
      "fee\_binancepay": 0.0033883,  
      "paid\_ves": true,  
      "amount\_ves\_received": "170,000",  
      "fee\_received": "0,000",  
      "spidi\_id": "402e34dbaec5acf9fe10d072c9617d61",  
      "crypto\_reference": "279102864347",  
      "key\_user": "7188d621876ce235189b5956aae378d6",  
      "crypto\_order\_id\_ext": "fdd4be6e-bb6e-4946-894e-bb7de7334e89",  
      "bs\_from\_RIF": "J-500253931",  
      "bs\_from\_Bank": "BANCO PLAZA",  
      "clienttranid": "548eaf12-93c5-4439-b1cf-30ede615acef",  
      "coin\_received": "VES",  
      "bs\_from\_name": "Crixto Venezuela C.A.",  
      "bs\_from\_phone": "4244434446",  
      "bs\_from\_date": "2025-07-24 16:12:38"  
    }  
  }  
}
```

### **Orden ("PENDING")**

**Respuesta SPIDI (orden pending)**

```json
{  
  "success": true,  
  "message": "Consulta realizada con éxito.",  
  "user\_message": "La orden está pendiente de pago.",  
  "data": {  
    "crypto\_order\_id": "463",  
    "status": "pending",  
    "order\_details": {  
      "type\_order": "BinancePay",  
      "amount": "180.00",  
      "session\_id": "098ace94-ce70-4203-abc3-80e20bb6e4c6",  
      "platform": "Crixto",  
      "description": "PUNTO DE VENTA",  
      "paid": false,  
      "spidi\_id": "402e34dbaec5acf9fe10d072c9617d61"  
    }  
  }  
}
```

---

### **Orden Cancelada ("expired")**

**Respuesta SPIDI (expirada):**

```json
{  
  "success": true,  
  "message": "Consulta realizada con éxito.",  
  "user\_message": "La orden fue cancelada o expirada.",  
  "data": {  
    "crypto\_order\_id": "361",  
    "status": "expired",  
    "order\_details": {  
      "type\_order": "BinancePay",  
      "amount": "150.00",  
      "session\_id": "098ace94-ce70-4203-abc3-80e20bb6e4c6",  
      "platform": "Crixto",  
      "description": "PUNTO DE VENTA",  
      "paid": false,  
      "spidi\_id": "402e34dbaec5acf9fe10d072c9617d61"  
    }  
  }  
}
```

CUANDO ES CANCELLED O PENDING:

Cuando es PENDING:

data.qrImg y data.data\_qr existen, pero esos vienen en el Response de crear sesión cripto.

Cuando es COMPLETED

data.response y data.response.data existen.

Cuando es CANCELLED

data.response también existe, con menos campos