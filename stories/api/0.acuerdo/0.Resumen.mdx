import { Meta } from '@storybook/blocks';

<Meta title="API/Acuerdo/0. Resumen" />

# API de Acuerdos de Pago

## Descripci√≥n General

La API de Acuerdos de Pago es el n√∫cleo del sistema de distribuci√≥n y liquidaci√≥n inteligente de fondos de Spidi. Permite crear, gestionar y administrar contratos digitales que definen c√≥mo se procesar√°n las transacciones financieras, incluyendo la divisi√≥n autom√°tica de pagos entre m√∫ltiples receptores y la liquidaci√≥n bancaria inteligente.

### ¬øQu√© es un Acuerdo de Pago?

Un **Acuerdo de Pago** es un contrato digital que establece las reglas de distribuci√≥n y liquidaci√≥n para las transacciones. Funciona como un "contrato inteligente" que define:

- **C√≥mo se dividir√°n los fondos** entre el comercio propietario y sus partners o distribuidores
- **A qu√© cuentas bancarias** se dirigir√°n los pagos seg√∫n el banco de origen del pagador
- **Qu√© medios de pago** acepta el acuerdo (d√©bito inmediato, criptomonedas, pagos m√≥viles)
- **Las reglas de liquidaci√≥n** que optimizan la distribuci√≥n de fondos

### Funcionalidades Principales

#### üéØ Distribuci√≥n de Pagos (Split Payment)
- **Split Fijo (FIXED)**: Porcentajes de distribuci√≥n predefinidos y constantes para todas las transacciones
- **Split Din√°mico (SESSION)**: Configuraci√≥n flexible que se define en cada sesi√≥n de pago
- **M√∫ltiples Receptores**: Soporte para distribuir fondos entre el comercio propietario y m√∫ltiples partners
- **Validaci√≥n Autom√°tica**: Garantiza que la suma de porcentajes sea exactamente 100%

#### üè¶ Liquidaci√≥n Bancaria Inteligente
- **Reglas por Banco de Origen**: Dirige autom√°ticamente los pagos a diferentes cuentas seg√∫n el banco del pagador
- **Cuenta por Defecto**: Configuraci√≥n de respaldo para bancos no especificados en las reglas
- **Optimizaci√≥n de Costos**: Reduce comisiones bancarias dirigiendo pagos a cuentas espec√≠ficas
- **Soporte Multi-Banco**: Compatible con todos los bancos del sistema financiero venezolano

#### üí≥ Medios de Pago Configurables
- **D√©bito Inmediato**: Pagos directos desde cuentas bancarias
- **Criptomonedas**: Soporte para pagos con Bitcoin, Ethereum y otras criptomonedas
- **Pagos M√≥viles**: Integraci√≥n con sistemas de pago m√≥vil y billeteras digitales
- **Configuraci√≥n Flexible**: Cada acuerdo puede habilitar/deshabilitar medios espec√≠ficos

#### üîÑ Gesti√≥n del Ciclo de Vida
- **Estados del Acuerdo**: Active, Inactive, Cancelled
- **Auditor√≠a Completa**: Trazabilidad de creaci√≥n, modificaciones y uso
- **Versionado**: Historial de cambios y actualizaciones
- **Validaci√≥n en Tiempo Real**: Verificaci√≥n de integridad y consistencia

### Casos de Uso T√≠picos

#### üè™ Comercios con Partners
- **Distribuci√≥n de Comisiones**: Automatiza el pago de comisiones a partners y distribuidores
- **Marketplace**: Divide pagos entre vendedores y la plataforma
- **Franquicias**: Gestiona la distribuci√≥n de ingresos entre franquiciador y franquiciados

#### üè¢ Plataformas de Servicios
- **Servicios de Suscripci√≥n**: Distribuye ingresos entre proveedores de contenido y la plataforma
- **Servicios de Entrega**: Divide pagos entre restaurantes, repartidores y la plataforma
- **Servicios Financieros**: Gestiona la distribuci√≥n entre prestamistas y la plataforma

#### üè¶ Optimizaci√≥n Bancaria
- **Reducci√≥n de Costos**: Dirige pagos a cuentas con menores comisiones
- **Liquidaci√≥n Eficiente**: Optimiza la distribuci√≥n seg√∫n el banco de origen
- **Gesti√≥n de Riesgo**: Diversifica la exposici√≥n bancaria

### Tipos de Acuerdo

#### üîò Acuerdo Tipo "Button"
- **Uso**: Para pagos iniciados por el comercio (botones de pago)
- **Caracter√≠sticas**: Configuraci√≥n m√°s simple, ideal para e-commerce
- **Aplicaci√≥n**: Tiendas online, servicios digitales, suscripciones

#### üìã Acuerdo Tipo "Request"
- **Uso**: Para solicitudes de pago enviadas al cliente
- **Caracter√≠sticas**: Mayor flexibilidad en la configuraci√≥n
- **Aplicaci√≥n**: Facturaci√≥n, servicios B2B, pagos programados

### Ventajas del Sistema

#### ‚ö° Automatizaci√≥n Completa
- **Sin Intervenci√≥n Manual**: La distribuci√≥n y liquidaci√≥n ocurre autom√°ticamente
- **Tiempo Real**: Procesamiento inmediato de transacciones
- **Escalabilidad**: Maneja miles de transacciones simult√°neamente

#### üõ°Ô∏è Seguridad y Confiabilidad
- **Encriptaci√≥n End-to-End**: Protecci√≥n de datos sensibles
- **Validaci√≥n Multi-Capa**: Verificaci√≥n de integridad en cada paso
- **Auditor√≠a Completa**: Trazabilidad total de todas las operaciones

#### üìä Transparencia y Control
- **Reportes Detallados**: Visibilidad completa de todas las transacciones
- **Dashboard en Tiempo Real**: Monitoreo de acuerdos y distribuciones
- **Alertas Autom√°ticas**: Notificaciones de eventos importantes

## Endpoints Disponibles

### Operaciones CRUD Completas

* **POST** `/api/v1/agreement` ‚Äî Crear un nuevo acuerdo de pago con configuraci√≥n completa de split y liquidaci√≥n
* **GET** `/api/v1/agreement/{agreement_id}` ‚Äî Consultar los detalles completos de un acuerdo espec√≠fico, incluyendo configuraci√≥n, estado y historial
* **GET** `/api/v1/agreement` ‚Äî Listar todos los acuerdos creados por el usuario con filtros y paginaci√≥n
* **PUT** `/api/v1/agreement/{agreement_id}` ‚Äî Actualizar un acuerdo existente, modificando configuraci√≥n de split, medios de pago o reglas de liquidaci√≥n
* **DELETE** `/api/v1/agreement/{agreement_id}` ‚Äî Eliminar un acuerdo de pago (soft delete con preservaci√≥n de historial)

### Caracter√≠sticas T√©cnicas

#### üîê Autenticaci√≥n y Autorizaci√≥n
- **Bearer Token**: Autenticaci√≥n mediante JWT
- **Scopes Granulares**: Control de acceso por funcionalidad
- **Rate Limiting**: Protecci√≥n contra abuso y sobrecarga

#### üìù Validaci√≥n y Errores
- **Validaci√≥n Estricta**: Verificaci√≥n de todos los par√°metros de entrada
- **Mensajes Descriptivos**: Errores claros y accionables
- **C√≥digos HTTP Est√°ndar**: Respuestas consistentes y predecibles

#### üîÑ Idempotencia
- **Claves Idempotentes**: Prevenci√≥n de duplicados accidentales
- **Transacciones At√≥micas**: Operaciones todo-o-nada
- **Consistencia de Datos**: Garant√≠a de integridad en todas las operaciones

## Flujo de Trabajo T√≠pico

1. **Creaci√≥n del Acuerdo**: Define las reglas de distribuci√≥n y liquidaci√≥n
2. **Configuraci√≥n de Split**: Establece c√≥mo se dividir√°n los fondos
3. **Definici√≥n de Reglas Bancarias**: Configura la liquidaci√≥n inteligente
4. **Activaci√≥n**: El acuerdo queda listo para procesar transacciones
5. **Uso en Sesiones**: El acuerdo se aplica autom√°ticamente en cada pago
6. **Monitoreo**: Seguimiento de transacciones y distribuciones
7. **Mantenimiento**: Actualizaciones y ajustes seg√∫n necesidades

## Integraci√≥n con Otros M√≥dulos

- **Sesiones de Pago**: Los acuerdos se aplican autom√°ticamente en las sesiones
- **Gesti√≥n de Cuentas**: Integraci√≥n con el sistema de cuentas bancarias
- **Reportes y Analytics**: Datos para an√°lisis y reportes financieros
- **Notificaciones**: Alertas y notificaciones de eventos importantes

---

*Para m√°s detalles sobre cada endpoint espec√≠fico, consulta la documentaci√≥n individual de cada operaci√≥n.*