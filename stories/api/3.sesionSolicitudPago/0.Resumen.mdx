import { Meta } from '@storybook/blocks';

<Meta title="API/Sesion Solicitud de Pago/0. Resumen" />

## **Bot√≥n de pago en SPIDI: lo esencial** 

El **bot√≥n de pago** se usa dentro de una aplicaci√≥n web o m√≥vil para permitir que el usuario **realice un pago inmediato**. Al hacer clic en el bot√≥n, se redirige temporalmente al usuario a una p√°gina de pago SPIDI, donde completa el pago, y luego se lo retorna a la app original.

Esto permite una experiencia integrada y controlada dentro del flujo principal del usuario.

Los **botones de pago** est√°n dise√±ados para integrarse directamente dentro de tu aplicaci√≥n web o m√≥vil, permitiendo iniciar el pago justo en el momento en que el usuario toma la decisi√≥n de compra. Son ideales para flujos de **checkout en tiendas online**, **activaci√≥n de servicios digitales**, **compras in-app**, **recargas de saldo**, **reservas con pago inmediato**, o incluso para **promociones limitadas** dentro de la plataforma. Tambi√©n se utilizan en √°reas de usuario donde el cliente puede hacer clic en ‚ÄúPagar ahora‚Äù para saldar deudas o renovar servicios. Al estar integrados al flujo de navegaci√≥n, ofrecen una experiencia fluida, controlada y en tiempo real entre frontend y backend.

### **Experiencia del cliente en la p√°gina de pago SPIDI para botones de pago** 

En la p√°gina de SPIDI, el usuario ver√° informaci√≥n visual que confirma que el pago est√° asociado a tu aplicaci√≥n. Desde all√≠ puede:

* ‚úÖ Realizar el pago (exitosamente o fallar)  
* ‚è≥ Quedarse inactivo sin hacer nada  
* üîô Presionar el bot√≥n "Atr√°s" en el navegador

### **üîÑ Cambios de estado posibles**

Todas las sesiones de pago inician con estado pending. Luego, seg√∫n la acci√≥n del usuario o el paso del tiempo, SPIDI actualiza autom√°ticamente el estado a:

* paid ‚Üí si el pago se completa correctamente  
* failed ‚Üí si el usuario cancela o ocurre un error  
* expired ‚Üí si pasan m√°s de **10 minutos** sin completarse el pago

üí° Una vez que la sesi√≥n cambia a cualquiera de estos estados, **deja de ser v√°lida** y debe crearse una nueva para un nuevo intento.

Las sesiones de pago SPIDI **expiran a los 10 minutos** desde su creaci√≥n. Esto ayuda a prevenir pagos tard√≠os fuera de contexto. Si el usuario no completa el pago en ese tiempo, la sesi√≥n pasar√° autom√°ticamente a estado expired.

## **¬øQu√© pasa cuando el pago finaliza?**

Cuando el usuario hace clic en ‚ÄúPagar‚Äù en la p√°gina de SPIDI, tienes varias opciones para definir qu√© sucede a continuaci√≥n, dependiendo del tipo de integraci√≥n (web o app m√≥vil) y de la **experiencia que quieras construir:**

1. ‚úÖ **Redirecci√≥n inmediata a tu aplicaci√≥n:**  
    Puedes configurar que SPIDI redirija autom√°ticamente al usuario a tu p√°gina de √©xito o de fallo, donde t√∫ mostrar√°s el resultado de la transacci√≥n.  
   1. En **aplicaciones web**, estas URLs suelen ser rutas de tu sitio (por ejemplo, /pago/exito).

   2. En **aplicaciones m√≥viles**, estas URLs suelen ser **deep links** (por ejemplo, miapp://pago/exito) que permiten reabrir la app y mostrar una vista nativa con el estado del pago.  
        
2. ‚úÖ **Mostrar una pantalla de resultado en SPIDI y luego redirigir:**  
    SPIDI puede mostrar una pantalla propia (de √©xito o fallo) y, despu√©s de unos segundos, redirigir autom√°ticamente a tu app o sitio web, tal como la opci√≥n 1\.  
     
3. üß≠ **Permanecer en SPIDI con instrucciones claras:**  
    Tambi√©n puedes optar por no redirigir autom√°ticamente. En ese caso, SPIDI mostrar√° una pantalla final (de √©xito o fallo) con instrucciones para que el usuario regrese manualmente a tu app o sitio web (ver estrategia 2).

4. üß© **Intercepci√≥n del cambio de URL (en WebView):**  
   En integraciones m√≥viles que usan WebView, si **no puedes utilizar deep links**, puedes detectar el cambio de URL al finalizar el pago como se√±al para cerrar el WebView y mostrar tu pantalla,

En todos los casos tu app puede mostrar una pantalla con el resultado de la transacci√≥n, validando el estado de la transacci√≥n consultando el endpoint a trav√©s del session\_id. Para saber c√≥mo manejar este momento en tu flujo, revisa las secciones espec√≠ficas de esta gu√≠a para aplicaciones web, m√≥viles o enlaces de pago.

### 

### 

### **Configurar un webhook (altamente recomendado)**

SPIDI puede notificar a tu servidor en tiempo real cuando una sesi√≥n cambia de estado. Es decir, una comunicaci√≥n de nuestro API a tu API.

**Con esto, nosotros** enviamos un <i>POST</i> a tu webhook_url cuando el estado cambie a <i>paid</i>, <i>failed</i> o <i>expired</i>.

<i>Dependiendo de la l√≥gica que uses, esto te permite activar procesos automatizados internos.</i>
