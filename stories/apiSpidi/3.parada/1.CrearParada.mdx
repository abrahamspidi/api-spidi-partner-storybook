import { Meta } from '@storybook/blocks';

<Meta title="API-SPIDI/Parada/1. Crear Parada" />

# Crear Parada(s) - Create Stop(s)

This endpoint allows you to create one or multiple stops in the SPIDI system. Stops are used to manage payment collections and user interactions.

## Endpoint

```
POST /v1/stops
```

## Request Body

The request body contains information about the stops you want to create:

```json
{
  "spidi_id": "a966ce0d-3af3-415d-ba86-1db5a1c21cf0",
  "continue_on_error": false,
  "items": [
    {
      "internal_reference": "8233232",
      "stop_title": "Federico Díaz",
      "empty_state_message": "No tienes pagos pendientes",
      "status": "active"
    },
    {
      "internal_reference": "8233235",
      "stop_title": "Juan González",
      "empty_state_message": "No tienes pagos pendientes",
      "status": "active"
    }
  ]
}
```

## Field Descriptions

### Root Level Fields

| Campo | Tipo | Requerido | Descripción |
|-------|------|-----------|-------------|
| `spidi_id` | `string (UUID)` | ✔ Sí | Identificador del comercio en SPIDI (validado contra las credenciales del request) |
| `continue_on_error` | `boolean` | ❌ No | Si continuar procesando otros items cuando uno falla (default: false) |
| `items` | `array` | ✔ Sí | Array de stops a crear |

### Item Fields

| Campo | Tipo | Requerido | Descripción |
|-------|------|-----------|-------------|
| `internal_reference` | `string` | ✔ Sí | Referencia interna única del stop |
| `stop_title` | `string` | ✔ Sí | Título descriptivo del stop |
| `empty_state_message` | `string` | ❌ No | Mensaje a mostrar cuando no hay pagos pendientes |
| `status` | `string` | ✔ Sí | Estado del stop (`active`, `inactive`, `pending`) |

## Example Titles

Here are some examples of good stop titles:

- "Cuenta de usuario" (User account)
- "Merienda del 15 agosto" (August 15th snack)
- "Condominio Edificio." (Building Condominium.)

## Response

### Success Response (201 Created)

```json
{
  "success": true,
  "data": {
    "created_stops": [
      {
        "id": "stop_123456789",
        "internal_reference": "8233232",
        "stop_title": "Federico Díaz",
        "status": "active",
        "created_at": "2024-01-15T10:30:00Z"
      },
      {
        "id": "stop_123456790",
        "internal_reference": "8233235",
        "stop_title": "Juan González",
        "status": "active",
        "created_at": "2024-01-15T10:30:00Z"
      }
    ],
    "total_created": 2,
    "total_failed": 0
  }
}
```

### Error Response (400 Bad Request)

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid request data",
    "details": [
      {
        "field": "items[0].internal_reference",
        "message": "Internal reference is required"
      }
    ]
  }
}
```

## Code Examples

### JavaScript/Node.js

```javascript
const createStops = async () => {
  const response = await fetch('https://api.spidipagos.com/v1/stops', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer YOUR_API_KEY',
      'X-SPIDI-ID': 'a966ce0d-3af3-415d-ba86-1db5a1c21cf0'
    },
    body: JSON.stringify({
      spidi_id: 'a966ce0d-3af3-415d-ba86-1db5a1c21cf0',
      continue_on_error: false,
      items: [
        {
          internal_reference: '8233232',
          stop_title: 'Federico Díaz',
          empty_state_message: 'No tienes pagos pendientes',
          status: 'active'
        }
      ]
    })
  });

  const result = await response.json();
  console.log(result);
};
```

### Python

```python
import requests
import json

def create_stops():
    url = "https://api.spidipagos.com/v1/stops"
    headers = {
        "Content-Type": "application/json",
        "Authorization": "Bearer YOUR_API_KEY",
        "X-SPIDI-ID": "a966ce0d-3af3-415d-ba86-1db5a1c21cf0"
    }
    
    data = {
        "spidi_id": "a966ce0d-3af3-415d-ba86-1db5a1c21cf0",
        "continue_on_error": False,
        "items": [
            {
                "internal_reference": "8233232",
                "stop_title": "Federico Díaz",
                "empty_state_message": "No tienes pagos pendientes",
                "status": "active"
            }
        ]
    }
    
    response = requests.post(url, headers=headers, json=data)
    return response.json()
```

## Error Handling

### Common Error Codes

| Code | Description | Solution |
|------|-------------|----------|
| `VALIDATION_ERROR` | Invalid request data | Check required fields and data types |
| `DUPLICATE_REFERENCE` | Internal reference already exists | Use a unique internal reference |
| `INVALID_SPIDI_ID` | SPIDI ID not found or invalid | Verify your SPIDI ID |
| `RATE_LIMIT_EXCEEDED` | Too many requests | Implement exponential backoff |

## Best Practices

1. **Use descriptive titles**: Make stop titles clear and meaningful
2. **Unique references**: Ensure internal references are unique across your system
3. **Error handling**: Always handle both success and error responses
4. **Batch operations**: Use the `items` array to create multiple stops efficiently
5. **Status management**: Set appropriate initial status for your stops

## Related Endpoints

- [Get Stop Information](./InfoStop)
- [List Stops](./ListStops)
- [Update Stop](./UpdateStop)
- [Delete Stop](./DeleteStop)
