import { Meta } from '@storybook/blocks';

<Meta title="API/Parada/4. Listar Paradas" />

# 1. Descripción

Este endpoint lista **todas las paradas (stops)** del comercio autenticado, con soporte de **búsqueda y filtros** (por estado, título, referencia interna) y **paginación**. Es útil para construir listados administrativos, buscadores y reportes.

# 2. Endpoint

Method: **GET**
```
{{baseUrl}}/api/v1/payment-stops
```

# 3. Ejemplo del Request

Method: **GET**
```
{{baseUrl}}/api/v1/payment-stops?status=active&q=caja&limit=20&offset=0&sort=created_desc
```

# 4. Tabla de Parámetros del Request

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>status</b></td><td><b>string</b></td><td>❌ No</td><td>Filtra por estado de la parada: <b><i>active</i></b> o <b><i>disabled</i></b>. Si se omite, se listan todas.</td></tr>
<tr><td><b>q</b></td><td><b>string</b></td><td>❌ No</td><td>Búsqueda por texto en <b><i>stop_title</i></b> y/o <b><i>internal_reference</i></b> (contiene).</td></tr>
<tr><td><b>internal_reference</b></td><td><b>string</b></td><td>❌ No</td><td>Filtra por coincidencia exacta de la referencia interna.</td></tr>
<tr><td><b>from_date</b></td><td><b>string</b></td><td>❌ No</td><td>ISO 8601 (UTC). Devuelve paradas **creadas** desde esta fecha/hora (inclusive).</td></tr>
<tr><td><b>to_date</b></td><td><b>string</b></td><td>❌ No</td><td>ISO 8601 (UTC). Devuelve paradas **creadas** hasta esta fecha/hora (inclusive).</td></tr>
<tr><td><b>limit</b></td><td><b>integer</b></td><td>❌ No</td><td>Máximo de elementos a devolver. Por defecto <b><i>50</i></b>. Máximo recomendado <b><i>200</i></b>.</td></tr>
<tr><td><b>offset</b></td><td><b>integer</b></td><td>❌ No</td><td>Desplazamiento para paginación. Por defecto <b><i>0</i></b>.</td></tr>
<tr><td><b>sort</b></td><td><b>string</b></td><td>❌ No</td><td>Orden. Valores sugeridos: <b><i>created_desc</i></b> (default), <b><i>created_asc</i></b>, <b><i>updated_desc</i></b>, <b><i>updated_asc</i></b>.</td></tr>
</table>

Notas:

* Los filtros pueden combinarse (ej. `status=active&q=caja`).  
* Si envías `internal_reference`, tiene prioridad sobre `q` para ese campo.

# 5. Ejemplo de Response 200

```json
{
  "success": true,
  "message": "Payment stops retrieved successfully.",
  "data": {
    "total": 2,
    "limit": 20,
    "offset": 0,
    "items": [
      {
        "stop_id": "stp_92f3a5e1-1c9f-4a23-bbcd-6d42b0a0a9f4",
        "stop_url": "https://pay.spidi.com/s/stp_92f3a5e1-1c9f-4a23-bbcd-6d42b0a0a9f4",
        "internal_reference": "caja_001",
        "stop_title": "Caja Principal",
        "empty_state_message": "No hay pagos disponibles en este momento.",
        "status": "active",
        "created_at": "2025-09-27T14:05:21Z",
        "updated_at": "2025-09-30T10:12:34Z",
        "links_active_count": 1
      },
      {
        "stop_id": "stp_a12f34cd-56ef-78ab-90cd-12ef34ab56cd",
        "stop_url": "https://pay.spidi.com/s/stp_a12f34cd-56ef-78ab-90cd-12ef34ab56cd",
        "internal_reference": "condominio_torre_a",
        "stop_title": "Condominio Torre A",
        "empty_state_message": "No existen deudas registradas.",
        "status": "disabled",
        "created_at": "2025-08-12T09:31:10Z",
        "updated_at": "2025-09-01T08:15:00Z",
        "links_active_count": 0
      }
    ]
  }
}
```

# 6. Tabla de Response 200

## Campos del Nivel Principal

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>success</b></td><td>boolean</td><td>✅ Sí</td><td><b>Generado.</b> True si el endpoint se proceso de forma exitosa. False de lo contrario.</td></tr>
<tr><td><b>message</b></td><td>string</td><td>✅ Sí</td><td><b>Generado.</b> Mensaje de confirmación legible para humanos.</td></tr>
<tr><td><b>data</b></td><td>[objeto]</td><td>✅ Sí</td><td><b>Generado.</b> Lista del objeto con la información de las paradas creadas.</td></tr>
</table>

### 6.1 Subtabla: Response 200 → data

<table>
<tr><th>results.x</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>total</b></td><td><b>integer</b></td><td>✅ Sí</td><td>Total de paradas que cumplen con los filtros aplicados.</td></tr>
<tr><td><b>limit</b></td><td><b>integer</b></td><td>✅ Sí</td><td>Límite aplicado en esta página.</td></tr>
<tr><td><b>offset</b></td><td><b>integer</b></td><td>✅ Sí</td><td>Offset aplicado en esta página</td></tr>
<tr><td><b>items</b></td><td><b>[objeto]</b></td><td>✅ Sí</td><td>Lista de paradas devueltas en esta página.</td></tr>
</table>

### 6.2 Subtabla: Response 200 → data.items

<table>
<tr><th>results.x</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>stop_id</b></td><td><b>string/ null</b></td><td>✅ Sí</td><td><b>Generado.</b> Identificador de la Parada SPIDI creada.</td></tr>
<tr><td><b>stop_url</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Generado.</b> URL permanente de la parada individual.</td></tr>
<tr><td><b>internal_reference</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Eco.</b></td></tr>
<tr><td><b>stop_title</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Eco.</b></td></tr>
<tr><td><b>empty_state_message</b></td><td><b>string</b></td><td>❌ No</td><td><b>Eco.</b></td></tr>
<tr><td><b>status</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Eco + transformado.</b> <b><i>"active"</i></b> (por defecto) o <b><i>"disabled"</i></b> según el request.</td></tr>
<tr><td><b>created_at</b></td><td><b>string</b></td><td>✅ Sí</td><td>Fecha y hora de creación (ISO 8601).</td></tr>
<tr><td><b>links_active_count</b></td><td><b>integer</b></td><td>✅ Sí</td><td><b>Generado.</b> Número de enlaces activos en la parada.</td></tr>
<tr><td><b>updated_at</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Generado.</b> Fecha y hora de última actualización (ISO 8601).</td></tr>
</table>

# 7. Ejemplos de Response ≠ 200

### Error 400 - Bad Request
```json
{
  "success": false,
  "message": "Invalid query parameters.",
  "errors": {
    "status": "Allowed values are: active, disabled.",
    "limit": "Must be an integer between 1 and 200.",
    "from_date": "Must be a valid ISO 8601 datetime."
  }
}
```

# 8. Tabla de Errores

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>success</b></td><td><b>boolean</b></td><td>✅ Sí</td><td>Siempre false en caso de error.</td></tr>
<tr><td><b>message</b></td><td><b>string</b></td><td>✅ Sí</td><td>Resumen legible del error principal.</td></tr>
<tr><td><b>errors</b></td><td><b>objeto | null</b></td><td>❌ No</td><td>Detalle por campo (opcional).</td></tr>
</table>

### 8.1 Subtabla: errors (cuando exista)

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>status</b></td><td><b>string</b></td><td>❌ No</td><td>Valor fuera del conjunto permitido.</td></tr>
<tr><td><b>limit</b></td><td><b>string</b></td><td>❌ No</td><td>Límite fuera de rango o de tipo incorrecto.</td></tr>
<tr><td><b>from_date</b></td><td><b>string</b></td><td>❌ No</td><td>Fechas con formato inválido o rango inconsistente.</td></tr>
<tr><td><b>to_date</b></td><td><b>string</b></td><td>❌ No</td><td>Fechas con formato inválido o rango inconsistente.</td></tr>
</table>

## **Buenas prácticas**

* Usa `q` para búsquedas rápidas por título/referencia; si necesitas coincidencia exacta en referencia, usa `internal_reference`.

* Implementa paginación en tu UI con `limit` y `offset`.

* Ordena por `updated_desc` para ver primero las paradas modificadas recientemente.

* Si necesitas los **enlaces** de una parada, utiliza el endpoint complementario: `GET /api/v1/payment-stop/{stop_id}/links`.
