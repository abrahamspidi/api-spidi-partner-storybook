import { Meta } from '@storybook/blocks';

<Meta title="API-SPIDI/Parada/2. Info Historica" />

# 1. Descripción

Este endpoint devuelve la **lista completa de enlaces (links)** asociados a una parada (`stop_id`), incluyendo **activos** y **de histórico** (pagados o expirados).

Soporta **filtros** por estado y **paginación** para manejar colecciones grandes.

Uso típico: construir tablas/consultas administrativas, reportes o vistas detalladas de todos los enlaces de una parada

# 2. Endpoint

Method: **GET**
```
{{baseUrl}}/api/v1/payment-stops/{stop_id}/links
```

# 3. Ejemplo del Request

Method: **GET**
```
{{baseUrl}}/api/v1/payment-stops/7f8b2c6a-4d19-45df-9a10-3e872aa812c1/links?status=pending&limit=20&offset=0
```

# 4. Tabla de Parámetros del Request

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>stop_id</b></td><td><b>string (UUID)</b></td><td>✅ Sí</td><td>Identificador único de la parada (UUID).</td></tr>
<tr><td><b>status</b></td><td><b>string</b></td><td>❌ No</td><td>Filtra por estado del link. Valores: <b><i>pending</i></b>, <b><i>paid</i></b>, <b><i>expired</i></b>. Si se omite, se devuelven **todos**.</td></tr>
<tr><td><b>from_date</b></td><td><b>string</b></td><td>❌ No</td><td>ISO 8601 (UTC). Devuelve links **creados** desde esta fecha/hora (inclusive).</td></tr>
<tr><td><b>to_date</b></td><td><b>string</b></td><td>❌ No</td><td>ISO 8601 (UTC). Devuelve links **creados** hasta esta fecha/hora (inclusive).</td></tr>
<tr><td><b>limit</b></td><td><b>integer</b></td><td>❌ No</td><td>Máximo de elementos a devolver. Por defecto <b><i>50</i></b>. Máximo recomendado <b><i>200</i></b>.</td></tr>
<tr><td><b>offset</b></td><td><b>integer</b></td><td>❌ No</td><td>Desplazamiento para paginación. Por defecto <b><i>0</i></b>.</td></tr>
<tr><td><b>sort</b></td><td><b>string</b></td><td>❌ No</td><td>Orden. Valores sugeridos: <b><i>created_desc</i></b> (default), <b><i>created_asc</i></b>, <b><i>updated_desc</i></b>, <b><i>updated_asc</i></b>.</td></tr>
</table>

# 5. Ejemplo de Response 200

```json
{
  "success": true,
  "message": "Links retrieved successfully.",
  "data": {
    "stop_id": "7f8b2c6a-4d19-45df-9a10-3e872aa812c1",
    "total": 3,
    "limit": 20,
    "offset": 0,
    "items": [
      {
        "session_id": "21f43a2b-d9ff-42d2-87ce-559bdaf1f901",
        "status": "pending",
        "payment_url": "https://pay.spidi.com/21f43a2b-d9ff-42d2-87ce-559bdaf1f901",
        "created_at": "2025-02-15T12:30:22Z",
        "updated_at": "2025-02-15T12:31:10Z",
        "amount": 15.50,
        "currency_reference": "USD",
        "amount_ves": 1900.00,
        "bcv_exchange_rate": 122.58,
        "exchange_rate_from": "USD",
        "exchange_rate_to": "VES",
        "identifier_label": "Suscriptor",
        "identifier": "Juan Pérez",
        "description": "Mensualidad febrero",
        "due_date_link": "2025-03-01T00:00:00Z",
        "expire_behavior_link": "keep_active",
        "late_notice_message": "Tu servicio está inactivo. Paga para reactivar."
      },
      {
        "session_id": "ea1db23f-5932-49a5-a96d-08bfb14c9c34",
        "status": "paid",
        "payment_url": "https://pay.spidi.com/ea1db23f-5932-49a5-a96d-08bfb14c9c34",
        "created_at": "2025-01-30T16:55:11Z",
        "updated_at": "2025-01-30T17:05:40Z",
        "amount": 15.50,
        "currency_reference": "USD",
        "amount_ves": 1870.00,
        "bcv_exchange_rate": 120.65,
        "exchange_rate_from": "USD",
        "exchange_rate_to": "VES",
        "identifier_label": "Suscriptor",
        "identifier": "Juan Pérez",
        "description": "Mensualidad enero",
        "paid_at": "2025-01-30T17:05:33Z"
      },
      {
        "session_id": "b9d2d470-3c1e-4d3a-9b3a-8a7b0d7e3a12",
        "status": "expired",
        "payment_url": "https://pay.spidi.com/b9d2d470-3c1e-4d3a-9b3a-8a7b0d7e3a12",
        "created_at": "2025-01-10T10:10:05Z",
        "updated_at": "2025-01-10T10:20:15Z",
        "amount": 15.50,
        "currency_reference": "USD",
        "amount_ves": 1810.00,
        "bcv_exchange_rate": 116.77,
        "exchange_rate_from": "USD",
        "exchange_rate_to": "VES",
        "identifier_label": "Suscriptor",
        "identifier": "Juan Pérez",
        "description": "Mensualidad diciembre",
        "expired_at": "2025-01-10T10:20:15Z"
      }
    ]
  }
}
```

# 6. Tabla de Response 200

## Campos del Nivel Principal

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>success</b></td><td>boolean</td><td>✅ Sí</td><td><b>Generado.</b> True si el endpoint se proceso de forma exitosa. False de lo contrario.</td></tr>
<tr><td><b>message</b></td><td>string</td><td>✅ Sí</td><td><b>Generado.</b> Mensaje de confirmación legible para humanos.</td></tr>
<tr><td><b>data</b></td><td>[objeto]</td><td>✅ Sí</td><td><b>Generado.</b> Lista del objeto con la información de las paradas creadas.</td></tr>
</table>

### 6.1 Subtabla: Response 200 → data

<table>
<tr><th>results.x</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>stop_id</b></td><td><b>string/ null</b></td><td>✅ Sí</td><td><b>Generado.</b> Identificador de la Parada SPIDI creada.</td></tr>
<tr><td><b>total</b></td><td><b>integer</b></td><td>✅ Sí</td><td>Total de paradas que cumplen con los filtros aplicados.</td></tr>
<tr><td><b>limit</b></td><td><b>integer</b></td><td>✅ Sí</td><td>Límite aplicado en esta página.</td></tr>
<tr><td><b>offset</b></td><td><b>integer</b></td><td>✅ Sí</td><td>Offset aplicado en esta página</td></tr>
<tr><td><b>items</b></td><td><b>[objeto]</b></td><td>✅ Sí</td><td>Lista de enlaces</td></tr>
</table>

### 6.2 Subtabla: Response 200 → data.items

<table>
<tr><th>results.x</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>session_id</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Generado.</b> Identificador único de la sesión de pago creada.</td></tr>
<tr><td><b>status</b></td><td><b>string</b></td><td>✅ Sí</td><td>Estado: <b><i>pending</i></b>, <b><i>paid</i></b>, <b><i>expired</i></b></td></tr>
<tr><td><b>payment_url</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Generado.</b> Link "URL" donde el usuario puede ser redirigido para realizar el pago, sin pasar por la parada. En caso de haber creado parada, se recomienda suministrar al pagador el **stop_url**</td></tr>
<tr><td><b>created_at</b></td><td><b>string</b></td><td>✅ Sí</td><td>Fecha/hora de creación (ISO 8601).</td></tr>
<tr><td><b>updated_at</b></td><td><b>string</b></td><td>✅ Sí</td><td>Última actualización (ISO 8601).</td></tr>
<tr><td><b>currency_reference</b></td><td><b>string</b></td><td>✅ Sí</td><td>Moneda referencia que se usa como base para calcular el monto real en bolívares. Opciones: <b><i>"USD"</i></b>, <b><i>"EUR"</i></b>, <b><i>"COP"</i></b>. Si el monto en bolívares es fijo y no se desea indexar, se debe poner <b><i>"VES"</i></b>.</td></tr>
<tr><td><b>amount</b></td><td><b>number</b></td><td>✅ Sí</td><td>Monto total en la moneda indicada por currency_reference (2 decimales).</td></tr>
<tr><td><b>amount_ves</b></td><td><b>number</b></td><td>✅ Sí</td><td><b>Generado.</b> Monto calculado en bolívares al momento de la creación de la sesión de pago. Si la moneda referencia que se usó fue distinta a "VES", entonces este amount_ves irá cambiando a medida que cambie la tasa oficial.</td></tr>
<tr><td><b>bcv_exchange_rate</b></td><td><b>number</b></td><td>✅ Sí</td><td><b>Generado.</b> Tasa oficial usada para la conversión a bolívares, la cual puede ser diferente a la tasa oficial del día en que se pague el enlace.</td></tr>
<tr><td><b>exchange_rate_from</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Generado.</b> Moneda base de la tasa (p. ej., "USD").</td></tr>
<tr><td><b>exchange_rate_to</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Generado.</b> Moneda destino de la tasa (siempre "VES").</td></tr>
<tr><td><b>identifier_label</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Eco request.</b></td></tr>
<tr><td><b>identifier</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Eco request.</b></td></tr>
<tr><td><b>description</b></td><td><b>string</b></td><td>✅ Sí</td><td><b>Eco request.</b></td></tr>
<tr><td><b>due_date_link</b></td><td><b>string (ISO 8601)</b></td><td>❌ No</td><td>Fecha y hora límite (Venezuela) de vencimiento. Si se alcanza, el enlace se comportará como se elija en campo: **expire_behavior_link**</td></tr>
<tr><td><b>expire_behavior_link</b></td><td><b>string</b></td><td>❌ No</td><td>Define qué le ocurre al enlace al vencer el due_date_link. Valores posibles: <b><i>"expire"</i></b>: el enlace queda expirado. Si hay una parada asociada, se debe generar un nuevo enlace y asociar a la parada. <b><i>"keep_active"</i></b>: el enlace sigue vigente, pero se muestra una advertencia. Esto es ideal cuando no hay penalización en costo, pero sí en servicio.</td></tr>
<tr><td><b>late_notice_message</b></td><td><b>string</b></td><td>❌ No</td><td>Si posterior a la fecha de vencimiento el enlace sigue activo (keep_active), se mostrará el mensaje al pagador que se defina en este campo. Ejemplo: "Tu servicio está inactivo. Realiza el pago ahora para recuperar la continuidad de tu suscripción."</td></tr>
<tr><td><b>paid_at</b></td><td><b>string</b></td><td>❌ No</td><td>Fecha/hora de pago (solo si <b><i>status = paid</i></b>)</td></tr>
<tr><td><b>expired_at</b></td><td><b>string</b></td><td>❌ No</td><td>Fecha/hora de expiración (solo si <b><i>status = expired</i></b>).</td></tr>
</table>

### 

### 

# 7. Ejemplos de Response ≠ 200

### Error 400 - Bad Request
```json
{
  "success": false,
  "message": "Invalid query parameters.",
  "errors": {
    "status": "Allowed values are: pending, paid, expired.",
    "limit": "Must be an integer between 1 and 200.",
    "from_date": "Must be a valid ISO 8601 datetime."
  }
}
```

# 8. Tabla de Errores

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>success</b></td><td><b>boolean</b></td><td>✅ Sí</td><td>Siempre false en caso de error.</td></tr>
<tr><td><b>message</b></td><td><b>string</b></td><td>✅ Sí</td><td>Resumen legible del error principal.</td></tr>
<tr><td><b>errors</b></td><td><b>objeto | null</b></td><td>❌ No</td><td>Detalle por campo (opcional).</td></tr>
</table>

### 8.1 Subtabla: errors (cuando exista)

<table>
<tr><th>Campo</th><th>Tipo</th><th>Requerido</th><th>Descripción</th></tr>
<tr><td><b>stop_id</b></td><td><b>string</b></td><td>❌ No</td><td>El `stop_id` no existe o no pertenece a tus credenciales</td></tr>
<tr><td><b>status</b></td><td><b>string</b></td><td>❌ No</td><td>Valor fuera del conjunto permitido.</td></tr>
<tr><td><b>limit</b></td><td><b>string</b></td><td>❌ No</td><td>Límite fuera de rango o de tipo incorrecto.</td></tr>
<tr><td><b>from_date</b></td><td><b>string</b></td><td>❌ No</td><td>Fechas con formato inválido o rango inconsistente.</td></tr>
<tr><td><b>to_date</b></td><td><b>string</b></td><td>❌ No</td><td>Fechas con formato inválido o rango inconsistente.</td></tr>
</table>

## **Buenas prácticas**

* Usa filtros (`status`, fechas) y paginación (`limit`, `offset`) para controlar el volumen de datos.

* Si tu UI necesita **solo activos**, solicita `status=pending`.

* Para conciliaciones/reporte histórico, pagina resultados y ordena por `created_desc` o `updated_desc`.
